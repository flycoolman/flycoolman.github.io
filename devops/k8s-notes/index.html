<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Hongwei Li">

  
  
  
    
  
  <meta name="description" content="A free style notes of Kubernetes.">

  
  <link rel="alternate" hreflang="en-us" href="/devops/k8s-notes/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-146441609-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-146441609-3', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu42a5118afc49636e6fda7ce5d4b48056_3366_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu42a5118afc49636e6fda7ce5d4b48056_3366_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/devops/k8s-notes/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@flycoolman">
  <meta property="twitter:creator" content="@flycoolman">
  
  <meta property="og:site_name" content="flycoolman">
  <meta property="og:url" content="/devops/k8s-notes/">
  <meta property="og:title" content="Kubernetes Notes | flycoolman">
  <meta property="og:description" content="A free style notes of Kubernetes."><meta property="og:image" content="/devops/k8s-notes/featured.png">
  <meta property="twitter:image" content="/devops/k8s-notes/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-12-31T23:59:59&#43;00:00">
    
    <meta property="article:modified_time" content="2020-01-01T00:00:00&#43;00:00">
  

  



  


  


  





  <title>Kubernetes Notes | flycoolman</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">flycoolman</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">flycoolman</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Coding</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/coding/python/"><span>Python</span></a>
            
              <a class="dropdown-item" href="/coding/java/"><span>Java</span></a>
            
              <a class="dropdown-item" href="/coding/go/"><span>Go</span></a>
            
              <a class="dropdown-item" href="/coding/javascript/"><span>JavaScript</span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/linux/"><span>Linux</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/devops/"><span>DevOps</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/networking/"><span>Networking</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses/"><span>Courses</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link js-theme-selector" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-palette" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Kubernetes Notes</h1>

  

  


<div class="article-metadata">

  
  
  
  
  <div>
    

  
  <span ><a href="/author/hongwei-li/">Hongwei Li</a></span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Jan 1, 2020
  </span>
  

  

  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/linux/">Linux</a>, <a href="/category/system/">System</a>, <a href="/category/devops/">DevOps</a>, <a href="/category/sre/">SRE</a></span>
  

</div>

  














</div>


<div class="article-header container featured-image-wrapper mt-4 mb-4" style="max-width: 1200px; max-height: 624px;">
  <div style="position: relative">
    <img src="/devops/k8s-notes/featured_hu17716b4583cc34cc18f696ae16171d56_11324_1200x0_resize_lanczos_2.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <h2 id="k8s-notes">K8S NOTES</h2>
<h3 id="kubernetes-components">Kubernetes Components</h3>
<ul>
<li>Cluster
<ul>
<li>A cluster is a set of machines, called nodes, that run containerized applications managed by Kubernetes.</li>
<li>A cluster has at least one worker node and at least one master node.</li>
</ul>
</li>
<li>Node
<ul>
<li>Master node(s)<br>
The master node(s) manages the worker nodes and the pods in the cluster. Multiple master nodes are used to provide a cluster with failover and high availability.</li>
<li>Worker node(s)<br>
The worker node(s) host the pods that are the components of the application.</li>
</ul>
</li>
</ul>
<h4 id="master-node-components">Master Node Components</h4>
<ul>
<li>kube-apiserver</li>
<li>etcd</li>
<li>kube-scheduler</li>
<li>kube-controller-manager
<ul>
<li>Node Controller</li>
<li>Replication Controller</li>
<li>Endpoints Controller</li>
<li>Service Account &amp; Token Controllers</li>
</ul>
</li>
<li>cloud-controller-manager<br>
The following controllers have cloud provider dependencies:
<ul>
<li>Node Controller</li>
<li>Route Controller</li>
<li>Service Controller</li>
<li>Volume Controller</li>
</ul>
</li>
</ul>
<h4 id="worker-node-components">Worker Node Components</h4>
<ul>
<li>Kubelet</li>
<li>kube-proxy</li>
<li>Container Runtime</li>
</ul>
<h4 id="addons">Addons</h4>
<ul>
<li>DNS</li>
<li>Web UI (Dashboard)</li>
<li>Container Resource Monitoring</li>
<li>Cluster-level Logging</li>
</ul>
<h3 id="k8s-abbreviation">K8S Abbreviation</h3>
<h4 id="cni">CNI</h4>
<p>Kubernetes has adopted the Container Network Interface(CNI) specification for managing network resources on a cluster.</p>
<h4 id="cri">CRI</h4>
<p>Container Runtime Interface (CRI)<br>
Each container runtime has it own strengths, and many users have asked for Kubernetes to support more runtimes. CRI consists of a protocol buffers and gRPC API, and libraries, with additional specifications and tools under active development.<br>
Kubelet communicates with the container runtime (or a CRI shim for the runtime) over Unix sockets using the gRPC framework, where kubelet acts as a client and the CRI shim as the server.<br>
<img src="./cri.png" alt="cri.png"></p>
<ul>
<li>Docker</li>
<li>CRI-O</li>
<li>Containerd</li>
<li>Other CRI runtimes: frakti</li>
</ul>
<h4 id="csi">CSI</h4>
<p>The goal of CSI is to establish a standardized mechanism for Container Orchestration Systems (COs) to expose arbitrary storage systems to their containerized workloads.
Assuming a CSI storage plugin is already deployed on a Kubernetes cluster, users can use CSI volumes through the familiar Kubernetes storage API objects:</p>
<ul>
<li>PersistentVolumeClaims</li>
<li>PersistentVolumes</li>
<li>StorageClasses</li>
</ul>
<h4 id="crd">CRD</h4>
<p>CustomResourceDefinition</p>
<h3 id="k8s-networking">K8S Networking</h3>
<h4 id="pod-communication">POD Communication</h4>
<ul>
<li>
<p>Inner POD<br>
Multi-containers in one POD<br>
Containers within a pod share an IP address and port space, and can find each other via localhost. They can also communicate with each other using standard inter-process communications.</p>
<ul>
<li>Shared volume</li>
<li>IPC, i.e. queue</li>
<li>Networking, localhost with different port</li>
</ul>
</li>
<li>
<p>Inter PODs</p>
</li>
</ul>
<h3 id="services">Services</h3>
<h4 id="clusterip">ClusterIP</h4>
<p>ClusterIP accesses the services through proxy.<br>
ClusterIP can access services only inside the cluster.<br>
<img src="./clusterip.png" alt="clusterip"></p>
<h4 id="nodeport">Nodeport</h4>
<p>NodePort opens a specific port on each node of the cluster and traffic on that node is forwarded directly to the service.<br>
<img src="./nodeport.png" alt="nodeport"></p>
<h4 id="loadbalancer">Loadbalancer</h4>
<p>All the traffic on the port is forwarded to the service, there&rsquo;s no filtering, no routing.<br>
<img src="./loadbalancer.png" alt="loadbalancer"></p>
<h3 id="ingress-controller">Ingress Controller</h3>
<p>Ingress Controller but there are third party solutions like <strong>Traefik</strong> and <strong>Nginx</strong> available. Ingress controller also provide L7 load balancing unlike cluster services.</p>
<h3 id="network-policies">Network policies</h3>
<p>Isolation policies are configured on a per-namespace basis.<br>

<a href="https://cloudnativelabs.github.io/post/2017-04-18-kubernetes-networking/" target="_blank" rel="noopener">Kubernetes Networking</a></p>
<h3 id="k8s-objects">K8S Objects</h3>
<p>To find all the objects in some specific API version:</p>
<ul>
<li>kubectl api-resources | cut -c92-</li>
<li>kubectl api-resources | cut -c92-150</li>
<li>kubectl api-resources | cut -c92-150 | wc -l</li>
<li>kubectl api-resources</li>
</ul>
<h4 id="pod">Pod</h4>
<p>A thin wrapper around one or more containers</p>
<h4 id="daemonset">DaemonSet</h4>
<p>Implements a single instance of a pod on a worker node</p>
<h4 id="deployment">Deployment</h4>
<p>Details how to roll out (or roll back) across versions of your application</p>
<h4 id="replicaset">ReplicaSet</h4>
<p>Ensures a defined number of pods are always running</p>
<h4 id="job">Job</h4>
<p>Ensures a pod properly runs to completion</p>
<h4 id="service">Service</h4>
<p>Maps a fixed IP address to a logical group of pods</p>
<h4 id="label">Label</h4>
<p>Key/Value pairs used for association and filtering<br>
Labels in Kubernetes are intended to be used to specify identifying attributes for objects. They are used by selector queries or with label selectors. Since they are used internally by Kubernetes, the structure of keys and values is constrained, to optimize queries.</p>
<h4 id="annotations">Annotations</h4>
<p>annotations are a way to attach non-identifying metadata to objects. This metadata is not used internally by Kubernetes, so they cannot be used to identify within k8s. Instead, they are used by external tools and libraries. Examples of annotations include build/release timestamps, client library information for debugging, or fields managed by a network policy like Calico in this case.</p>
<h4 id="label-vs-annotation">Label vs. Annotation</h4>
<p>You can use either labels or annotations to attach metadata to Kubernetes objects. Labels can be used to select objects and to find collections of objects that satisfy certain conditions. In contrast, annotations are not used to identify and select objects.</p>
<h4 id="taints-and-tolerations">Taints and Tolerations</h4>
<p>Node affinity, described here, is a property of pods that attracts them to a set of nodes (either as a preference or a hard requirement). Taints are the opposite – they allow a node to repel a set of pods.</p>
<p>Taints and tolerations work together to ensure that pods are not scheduled onto inappropriate nodes. One or more taints are applied to a node; this marks that the node should not accept any pods that do not tolerate the taints. Tolerations are applied to pods, and allow (but do not require) the pods to schedule onto nodes with matching taints.</p>
<h4 id="node-isolationrestriction">Node isolation/restriction</h4>
<p>Adding labels to Node objects allows targeting pods to specific nodes or groups of nodes. This can be used to ensure specific pods only run on nodes with certain isolation, security, or regulatory properties.</p>
<h4 id="nodeselector">NODESELECTOR</h4>
<ol>
<li>Attach a label to the node</li>
<li>Add a nodeSelector field to your pod configuration</li>
</ol>
<h4 id="affinity-and-anti-affinity">Affinity and anti-affinity</h4>
<pre><code>• Node affinity
• Inter-pod affinity and anti-affinity
</code></pre>
<p>nodeSelector provides a very simple way to constrain pods to nodes with particular labels. The affinity/anti-affinity feature, currently in beta, greatly extends the types of constraints you can express. The key enhancements are:</p>
<pre><code>• The language is more expressive (not just “AND of exact match”)
• You can indicate that the rule is “soft”/“preference” rather than a hard requirement, so if the scheduler can’t satisfy it, the pod will still be scheduled
• You can constrain against labels on other pods running on the node (or other topological domain), rather than against labels on the node itself, which allows rules about which pods can and cannot be co-located
</code></pre>
<p>The affinity feature consists of two types of affinity, “node affinity” and “inter-pod affinity/anti-affinity”. Node affinity is like the existing nodeSelector (but with the first two benefits listed above), while inter-pod affinity/anti-affinity constrains against pod labels rather than node labels, as described in the third item listed above, in addition to having the first and second properties listed above.</p>
<p>Node affinity is conceptually similar to nodeSelector – it allows you to constrain which nodes your pod is eligible to be scheduled on, based on labels on the node.</p>
<h3 id="deploy">Deploy</h3>
<p>When you wish to deploy an application in Kubernetes, you usually define three components:</p>
<ul>
<li>a <strong>Deployment</strong> — which is a recipe for creating copies of your application called Pods</li>
<li>a <strong>Service</strong> — an internal load balancer that routes the traffic to Pods</li>
<li>an <strong>Ingress</strong> — a description of how the traffic should flow from outside the cluster to your Service</li>
</ul>
<h3 id="ingress">Ingress</h3>
<h4 id="what-is-an-ingress">What is an ingress?</h4>
<p>In Kubernetes, an Ingress is an object that allows access to your Kubernetes services from outside the Kubernetes cluster. You configure access by creating a collection of rules that define which inbound connections reach which services.<br>
<br>
Ingress, added in Kubernetes v1.1, exposes HTTP and HTTPS routes from outside the cluster to services within the cluster. Traffic routing is controlled by rules defined on the Ingress resource.<br>
<br>
Internet&mdash;[ Ingress ]&ndash;|&ndash;|&ndash;[ Services ]
<br></p>
<p>An Ingress can be configured to give services externally-reachable URLs, load balance traffic, terminate SSL, and offer name based virtual hosting. An Ingress controller is responsible for fulfilling the Ingress, usually with a loadbalancer, though it may also configure your edge router or additional frontends to help handle the traffic.</p>
<p>An Ingress does not expose arbitrary ports or protocols. Exposing services other than HTTP and HTTPS to the internet typically uses a service of type NodePort or LoadBalancer.</p>
<h4 id="what-is-an-ingress-controller">What is an ingress controller?</h4>
<p>Kubernetes supports a high level abstraction called Ingress, which allows simple host or URL based HTTP routing. An ingress is a core concept (in beta) of Kubernetes, but is always implemented by a third party proxy. These implementations are known as ingress controllers.<br>
<br>
In order for the Ingress resource to work, the cluster must have an ingress controller running.<br>
Unlike other types of controllers which run as part of the kube-controller-manager binary, Ingress controllers are not started automatically with a cluster. Let’s see some options:</p>
<ul>
<li>ALB Ingress Controller</li>
</ul>
<h4 id="ingress-vs-ingress-controller">Ingress vs. Ingress controller</h4>
<ul>
<li>Ingress should be the rules for the traffic, which indicate the destination of a request will go through in the cluster.</li>
<li>Ingress Controller is the implementation for the Ingress. GCE and Nginx are both supported by k8s. They will take care of L4 or L7 proxy.</li>
<li>Just like other objects in K8s, ingress is also a type of object, which is mainly referred as set of redirection rules.</li>
<li>Where as ingress controller is like other deployment objects(could be deamon set as well) which listen and configure those ingress rules.</li>
<li>If I talk in terms of Nginx, Ingress controller is Nginx software itself where as ingress(ingress rules) are nginx configurations.</li>
</ul>
<h4 id="the-ingress-resource">The Ingress Resource</h4>
<p>A minimal ingress resource example:<br>
<img src="./ingress-resource-examle.png" alt="ingress-resource-examle"></p>
<p>As with all other Kubernetes resources, an Ingress needs apiVersion, kind, and metadata fields. Ingress frequently uses annotations to configure some options depending on the Ingress controller, an example of which is the rewrite-target annotation. Different Ingress controller support different annotations. Review the documentation for your choice of Ingress controller to learn which annotations are supported.<br>
The Ingress spec has all the information needed to configure a loadbalancer or proxy server. Most importantly, it contains a list of rules matched against all incoming requests. Ingress resource only supports rules for directing HTTP traffic.</p>
<h4 id="ingress-rules">Ingress Rules</h4>
<p>Each http rule contains the following information:</p>
<ul>
<li>An optional host. In this example, no host is specified, so the rule applies to all inbound HTTP traffic through the IP address specified. If a host is provided (for example, foo.bar.com), the rules apply to that host.</li>
<li>A list of paths (for example, /testpath), each of which has an associated backend defined with a serviceName and servicePort. Both the host and path must match the content of an incoming request before the loadbalancer will direct traffic to the referenced service.</li>
<li>A backend is a combination of service and port names as described in the services doc. HTTP (and HTTPS) requests to the Ingress matching the host and path of the rule will be sent to the listed backend.</li>
<li>A default backend is often configured in an Ingress controller that will service any requests that do not match a path in the spec.</li>
</ul>
<h4 id="default-backend">Default Backend</h4>
<p>An Ingress with no rules sends all traffic to a single default backend. The default backend is typically a configuration option of the Ingress controller and is not specified in your Ingress resources.</p>
<p>If none of the hosts or paths match the HTTP request in the Ingress objects, the traffic is routed to your default backend.</p>
<h3 id="configmap">ConfigMap</h3>
<p>
<a href="https://matthewpalmer.net/kubernetes-app-developer/articles/ultimate-configmap-guide-kubernetes.html" target="_blank" rel="noopener">Ultimate Guide to ConfigMaps in Kubernetes</a></p>
<h3 id="secrets">Secrets</h3>
<p>Secret data should be stored and handled in a way that can be easily hidden and possibly encrypted at rest if the environment is configured as such. The Secret data is represented as base64-encoded information, and it is critical to understand that this is not encrypted. As soon as the secret is injected into the pod, the pod itself can see the secret data in plain text.</p>
<p>Secret data is meant to be small amounts of data, limited by default in Kubernetes to 1 MB in size, for the base64-encoded data, so ensure that the actual data is approximately 750 KB because of the overhead of the encoding.</p>
<p>There are three types of secrets in Kubernetes:</p>
<ul>
<li>generic<br>
regular key/value pairs that are created from a file, a directory, or from string literals using the &ndash;from-literal= parameter.</li>
<li>docker-registry<br>
This is used by the kubelet when passed in a pod template if there is an imagePullsecret to provide the credentials needed to authenticate to a private Docker registry:</li>
<li>tls<br>
This creates a Transport Layer Security (TLS) secret from a valid public/private key pair. As long as the cert is in a valid PEM format, the key pair will be encoded as a secret and can be passed to the pod to use for SSL/TLS needs.</li>
</ul>
<h3 id="configmaps-vs-secrets">ConfigMaps vs Secrets</h3>
<ul>
<li>the ConfigMap API is meant more for string data that is not really sensitive data. If your application requires more sensitive data, the Secrets API is more appropriate.</li>
<li>ConfigMap data can be injected as either a volume mounted into the pod or as environment variables.</li>
<li>Secrets are also mounted into tmpfs only on the nodes that have a pod that requires the secret and are deleted when the pod that needs it is gone. This prevents any secrets from being left behind on the disk of the node.</li>
</ul>
<h3 id="roles">Roles</h3>
<p>Kubernetes has two types of roles, role and clusterRole, the difference being that role is specific to a namespace, and clusterRole is a cluster-wide role across all namespaces.</p>
<h3 id="rolebindings">RoleBindings</h3>
<p>The RoleBinding allows a mapping of a subject like a user or group to a specific role. Bindings also have two modes: roleBinding, which is specific to a namespace, and clusterRoleBinding, which is across the entire cluster.</p>
<h3 id="storage">Storage</h3>
<ul>
<li>PersistentVolume – the low level representation of a storage volume</li>
<li>Volume Driver – the code used to communicate with the backend storage provider</li>
<li>Pod – a running container that will consume a PersistentVolume</li>
<li>PersistentVolumeClaim – the binding between a Pod and PersistentVolume</li>
<li>StorageClass – allows for dynamic provisioning of PersistentVolumes</li>
</ul>
<h4 id="controllers-and-kubelets">Controllers and Kubelets</h4>
<p>Kubernetes has a number of controllers that run on the masters, monitor the state of the cluster and initiate actions in response to events.<br>
It also runs a kubelet process on all of the worker nodes. The kubelet stays in constant contact with the controllers, submitting metrics about current running pods and listening for new instructions.</p>
<h5 id="kubelet">Kubelet:</h5>
<ul>
<li>Mount and format new PersistentVolumes that are scheduled to this host</li>
<li>Start containers with PersistentVolume hostpath mounted inside the container</li>
<li>Stop containers and unmount the associated PersistentVolume</li>
<li>Constantly send metrics to the controllers about container &amp; PersistentVolume state</li>
</ul>
<h5 id="controller">Controller:</h5>
<ul>
<li>to match a PersistentVolumeClaim to a PersistentVolume</li>
<li>to dynamically provision a new PersistentVolume if a claim cannot be met (if enabled)
<ul>
<li>in the case of EBS this is done via the AWS api from the masters</li>
</ul>
</li>
<li>to attach the backend storage to a specific node if needed
<ul>
<li>in the case of EBS this is done via the AWS api from the masters</li>
</ul>
</li>
<li>to instruct the kubelet for a node to mount (and potentially format) the volume
<ul>
<li>this is done on the actual node</li>
</ul>
</li>
<li>to instruct the kubelet to start a container that uses the volume<br>
The kubelet itself performs the low-level mount and mkfs commands when instructed by the controller.</li>
</ul>
<h3 id="kubernetes-operator">Kubernetes Operator</h3>
<p>An Operator is an application-specific controller that extends the Kubernetes API to create, configure, and manage instances of complex stateful applications on behalf of a Kubernetes user. It builds upon the basic Kubernetes resource and controller concepts but includes domain or application-specific knowledge to automate common tasks.<br>
Examples are:</p>
<ul>
<li>elasticsearch-operator</li>
<li>prometheus-operator</li>
<li>cassandra-operator</li>
<li>Flux  The GitOps Kubernetes Operator</li>
</ul>
<div class="alert alert-note">
  <div>
    TBD
  </div>
</div>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>
<a href="https://learnk8s.io/troubleshooting-deployments" target="_blank" rel="noopener">A visual guide on troubleshooting Kubernetes deployments</a> | 
<a href="./A-visual-guide-on-troubleshooting-Kubernetes.pdf">PDF</a></p>
<h2 id="links">Links</h2>
<p>
<a href="https://cloudnativelabs.github.io/post/2017-04-18-kubernetes-networking/" target="_blank" rel="noopener">Kubernetes Networking</a><br>

<a href="https://matthewpalmer.net/kubernetes-app-developer/articles/ultimate-configmap-guide-kubernetes.html" target="_blank" rel="noopener">Ultimate Guide to ConfigMaps in Kubernetes</a><br>

<a href="https://learnk8s.io/troubleshooting-deployments" target="_blank" rel="noopener">A visual guide on troubleshooting Kubernetes deployments</a><br>

<a href="https://portworx.com/basic-guide-kubernetes-storage/" target="_blank" rel="noopener">A Basic Guide to Kubernetes Storage: PVS, PVCs, Statefulsets and More</a></p>
<br>
<h4 id="did-you-find-this-page-helpful-consider-sharing-it-">Did you find this page helpful? Consider sharing it 🙌</h4>

    </div>

    






<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/linux/">Linux</a>
  
  <a class="badge badge-light" href="/tag/system/">System</a>
  
  <a class="badge badge-light" href="/tag/kubernetes/">Kubernetes</a>
  
  <a class="badge badge-light" href="/tag/k8s/">K8S</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/devops/k8s-notes/&amp;text=Kubernetes%20Notes" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/devops/k8s-notes/&amp;t=Kubernetes%20Notes" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Kubernetes%20Notes&amp;body=/devops/k8s-notes/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/devops/k8s-notes/&amp;title=Kubernetes%20Notes" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=Kubernetes%20Notes%20/devops/k8s-notes/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/devops/k8s-notes/&amp;title=Kubernetes%20Notes" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
    
    





  
    
    
    
      
    
    
    
    <div class="media author-card content-widget-hr">
      
        
        <img class="avatar mr-3 avatar-circle" src="/author/hongwei-li/avatar_hu33d8f2710ea4928d295bd08cdc05f6eb_17524_270x270_fill_q90_lanczos_center.jpg" alt="Hongwei Li">
      

      <div class="media-body">
        <h5 class="card-title"><a href="/">Hongwei Li</a></h5>
        <h6 class="card-subtitle">Software, Networking</h6>
        <p class="card-text">Always on the way - Coding, DevOps, Networking.</p>
        <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:flycoolman@gmail.com" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/flycoolman" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/flycoolman" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

      </div>
    </div>
  


  
















  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.37431be2d92d7fb0160054761ab79602.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    ©2021 flycoolman.com All Rights Reserved
  </p>

  
  






  <p class="powered-by">
    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
